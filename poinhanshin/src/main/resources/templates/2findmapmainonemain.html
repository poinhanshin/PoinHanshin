<!DOCTYPE html>
<html lang="ko"
      xmlns:th="http://www.thymeleaf.org"
      xmlns:layout="http://www.ultraq.net.nz/thymeleaf/layout"
      layout:decorate="~{layout/layout}">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>findmap</title>
  <!--  <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.2.3/dist/css/bootstrap.min.css" rel="stylesheet">-->
  <link rel="stylesheet" type="text/css" href="/css/map/mapmain.css">
  <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.2.3/dist/css/bootstrap.min.css" rel="stylesheet">
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0-beta3/css/all.min.css">
  <link href="https://fonts.googleapis.com/css?family=Black+Han+Sans:400" rel="stylesheet">
  <link href="https://fonts.googleapis.com/css?family=Nanum+Gothic+Coding:400" rel="stylesheet">
  <link href="https://fonts.googleapis.com/css?family=Nanum+Gothic:800" rel="stylesheet">
  <script src="//t1.daumcdn.net/mapjsapi/bundle/postcode/prod/postcode.v2.js"></script>
</head>
<body layout:fragment="content">
<div class="container">
  <div class="post-header">
    <div class="header-right">
      <button class="icon-btn" onclick="location.href='findmapmain.html'" data-toggle="tooltip" data-placement="top" title="지도">
        <i class="fa-solid fa-map fa-2xl" style="color: #7605ff;"></i>
      </button>
      <button class="icon-btn" onclick="location.href='findmaplist.html'" data-toggle="tooltip" data-placement="top" title="리스트뷰">
        <i class="fa-solid fa-list-ul fa-2xl" style="color: #7605ff;"></i>
      </button>
      <button class="icon-btn" onclick="location.href='findmapreg.html'" data-toggle="tooltip" data-placement="top" title="글 작성하기">
        <i class="fa-regular fa-pen-to-square fa-2xl" style="color: #7605ff;"></i>
      </button>
    </div>
  </div>

  <!-- 지도를 표시할 div 입니다 -->
  <div id="content"></div>
  <div id="map"></div>
  <div id="popup"></div>

  <div class="header-left" style="display: flex; flex-direction: row;">
    <!-- 드롭다운 필터 -->
    <div class="filter-container">
      <label for="animal-filter">동물 선택:</label>
      <select id="animal-filter">
        <option value="0">전체</option>
        <option value="1">고양이</option>
        <option value="2">강아지</option>
      </select>
    </div>

    <!-- 신고자/발견자 선택 드롭다운 필터 -->
    <div class="filter-container">
      <label for="author-filter">신고자/발견자 선택:</label>
      <select id="author-filter">
        <option value="all">전체</option>
        <option value="신고자">신고자</option>
        <option value="발견자">발견자</option>
      </select>
    </div>

    <!-- 지역 선택 드롭다운 필터 -->
    <div class="filter-container">
      <div class="mb-3 d-flex align-items-center">
        <label class="form-label" for="location-filter">지역 선택:</label>
        <input type="text" class="form-control mx-1" style="width: 200px;" id="location-filter" placeholder="지역">
        <input type="button" class="btn mx-1 btn-outline-dark" onclick="map_Postcode()" value="지역 찾기">
      </div>
    </div>
  </div>
  <div class="favorites-container">
    <div style="display: flex; flex-direction: row; justify-content: space-between;">
      <h2>즐겨찾기 목록</h2>
      <button class="btn btn-primary" id="pathbtn">경로 찾기</button>
    </div>
    <div class="favorites-list">
      <!-- 데이터를 표시할 테이블 -->
      <div class="table-responsive">
        <table class="table table-bordered table-striped" id="animal-table">
          <thead>
          <tr>
            <th>글 번호</th>
            <th>동물 종류</th>
            <th>동물 이름</th>
            <th>신고자/발견자</th>
            <th>연락처</th>
            <th>동물 상태</th>
            <th>장소</th>
            <th>작성일</th>
            <th>선택</th> <!-- 체크 박스 추가 -->
          </tr>
          </thead>
          <tbody>
          <!-- 데이터가 여기에 동적으로 추가됩니다 -->
          </tbody>
        </table>
      </div>
    </div>
  </div>
</div>

<script type="text/javascript" src="//dapi.kakao.com/v2/maps/sdk.js?appkey=c4fc6b86f6659d02a7d040b2f3536a81"></script>
<script>
  // Kakao Map API를 사용하기 위해 필요한 앱 키를 여기에 입력하세요.
  var kakaoMapApiKey = 'c4fc6b86f6659d02a7d040b2f3536a81';

  // 페이지 로드가 완료된 후 실행되는 함수
  window.onload = function () {
    // Kakao Map API 스크립트를 동적으로 로드합니다.
    var script = document.createElement('script');
    script.type = 'text/javascript';
    script.src = '//dapi.kakao.com/v2/maps/sdk.js?appkey=' + kakaoMapApiKey;
    script.charset = 'utf-8';
    document.getElementsByTagName('head')[0].appendChild(script);

    script.onload = function () {
      // Kakao Map API를 초기화합니다.
      kakao.maps.load(function () {
        // 지도를 생성합니다.
        var map = new kakao.maps.Map(document.getElementById('map'), {
          center: new kakao.maps.LatLng(37.566826, 126.9786567), // 서울시청 좌표
          level: 8 // 지도 확대 레벨
        });

        // "경로 찾기" 버튼에 클릭 이벤트 리스너 추가
        var pathButton = document.getElementById('pathbtn');
        pathButton.addEventListener('click', showSelectedMarkers);

        // 선택한 마커를 저장할 배열을 만듭니다
        var selectedMarkers = [];
        var circleGroup = new kakao.maps.Group();

        function showSelectedMarkers() {
          // 선택한 체크 박스를 찾아서 처리합니다
          var checkboxes = document.querySelectorAll('input[type="checkbox"]');

          checkboxes.forEach(function (checkbox, index) {
            if (checkbox.checked) {
              // 체크된 체크 박스에 대한 마커를 생성합니다
              if (places[index]) {
                var markerPosition = new kakao.maps.LatLng(
                        places[index].latitude,
                        places[index].longitude
                );

                // 마커를 생성하고 지도에 추가합니다
                var marker = new kakao.maps.Marker({
                  position: markerPosition,
                  map: map
                });

                // 마커를 선택한 마커 배열에 추가합니다
                selectedMarkers.push(marker);

                // 원을 그립니다
                var circle = new kakao.maps.Circle({
                  map: map,
                  center: markerPosition,
                  radius: 500, // 원의 반지름 (원하는 크기로 변경 가능)
                  strokeWeight: 5,
                  strokeColor: '#75B8FA',
                  strokeOpacity: 1,
                  strokeStyle: 'dashed',
                  fillColor: 'rgba(225,108,108,0.98)',
                  fillOpacity: 0.7
                });
              }
            }
          });

          // 선택한 마커 주변에 원을 표시합니다
          if (selectedMarkers.length > 0) {
            // 마커들이 모두 표시되도록 지도의 중심 위치 설정
            var bounds = new kakao.maps.LatLngBounds();
            selectedMarkers.forEach(function (marker) {
              bounds.extend(marker.getPosition());
            });
            map.setBounds(bounds);
          }

          // 선택한 마커 주변에 원을 표시합니다
          selectedMarkers.forEach(function (markerPosition) {
            var circle = new kakao.maps.Circle({
              map: map,
              center: markerPosition,
              radius: 500, // 원의 반지름 (원하는 크기로 변경 가능)
              strokeWeight: 5,
              strokeColor: '#75B8FA',
              strokeOpacity: 1,
              strokeStyle: 'dashed',
              fillColor: 'rgba(225,108,108,0.98)',
              fillOpacity: 0.7
            });

            // 그룹에 원을 추가합니다
            circleGroup.add(circle);
          });

          // 선택한 마커 주변에 원을 표시합니다
          circleGroup.setMap(map);

          // 지도의 중심을 첫 번째 선택한 마커로 설정합니다
          map.setCenter(selectedMarkers[0].getPosition());
        }
      });
    }
  }

  // 예시 데이터 배열
  var places = [
    {
      latitude: 37.566826,
      longitude: 126.9786567,
      animalType: "강아지",
      animalName: "맥스",
      reporterType: "신고자",
      contact: "010-1234-5678",
      animalStatus: "미발견",
      location: "서울시청",
      createdDate: "2023-09-23"
    },
    {
      latitude: 37.5502,
      longitude: 126.9825,
      animalType: "고양이",
      animalName: "키티",
      reporterType: "발견자",
      contact: "010-9876-5432",
      animalStatus: "발견",
      location: "명동",
      createdDate: "2023-09-22"
    }
  ];

  // 데이터를 테이블에 추가하는 함수
  function populateTable() {
    var tableBody = document.querySelector("#animal-table tbody");

    places.forEach(function (place, index) {
      var row = tableBody.insertRow(index);
      var cell1 = row.insertCell(0);
      var cell2 = row.insertCell(1);
      var cell3 = row.insertCell(2);
      var cell4 = row.insertCell(3);
      var cell5 = row.insertCell(4);
      var cell6 = row.insertCell(5);
      var cell7 = row.insertCell(6);
      var cell8 = row.insertCell(7);
      var cell9 = row.insertCell(8);

      cell1.innerHTML = index + 1;
      cell2.innerHTML = place.animalType;
      cell3.innerHTML = place.animalName;
      cell4.innerHTML = place.reporterType;
      cell5.innerHTML = place.contact;
      cell6.innerHTML = place.animalStatus;
      cell7.innerHTML = place.location;
      cell8.innerHTML = place.createdDate;
      cell9.innerHTML = '<input type="checkbox">';
    });
  }

  // 페이지 로드 후 테이블 데이터 추가
  window.onload = function () {
    populateTable();

    // 각 테이블 행에 대한 클릭 이벤트 리스너 추가
    var tableRows = document.querySelectorAll('#animal-table tbody tr');
    tableRows.forEach(function (row, index) {
      row.addEventListener('click', function () {
        // 행을 클릭할 때마다 해당 행의 체크박스 상태를 토글합니다
        var checkbox = row.querySelector('input[type="checkbox"]');
        checkbox.checked = !checkbox.checked;
      });
    });
  };
</script>
</body>
</html>